sensor:
  - platform: alpha_vantage
    api_key: !secret alpha_vantage_api_key
    foreign_exchange:
      - name: Monero
        from: XMR
        to: EUR
  - platform: coinmarketcap
    currency_id: 328
  - platform: avanza_stock
    stock: 4175
    name: avanza_ibm
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: avanza_stock
    stock: 3873
    name: avanza_microsoft
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: avanza_stock
    stock: 732334
    name: avanza_munich_re
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: avanza_stock
    stock: 732348
    name: avanza_siemens
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: avanza_stock
    stock: 732395
    name: avanza_bayer
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: avanza_stock
    stock: 732289
    name: avanza_basf
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: avanza_stock
    stock: 732360
    name: avanza_allianz
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: avanza_stock
    stock: 3644
    name: avanza_procter_and_gamble
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: avanza_stock
    stock: 3666
    name: avanza_johnson_and_johnson
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: avanza_stock
    stock: 745799
    name: avanza_vinci
    monitored_conditions:
      - change
      - changePercent
      - country
      - currency
      - directYield
      - dividends
      - flagCode
      - hasInvestmentFees
      - highestPrice
      - id
      - isin
      - lastPrice
      - lastPriceUpdated
      - loanFactor
      - lowestPrice
      - marketCapital
      - marketList
      - marketMakerExpected
      - marketPlace
      - marketTrades
      - morningStarFactSheetUrl
      - name
      - numberOfOwners
      - orderDepthReceivedTime
      - priceAtStartOfYear
      - priceEarningsRatio
      - priceFiveYearsAgo
      - priceOneMonthAgo
      - priceOneWeekAgo
      - priceOneYearAgo
      - priceSixMonthsAgo
      - priceThreeMonthsAgo
      - priceThreeYearsAgo
      - pushPermitted
      - quoteUpdated
      - sector
      - shortSellable
      - superLoan
      - tickerSymbol
      - totalNumberOfShares
      - totalValueTraded
      - totalVolumeTraded
      - tradable
      - volatility
  - platform: rest
    resource: !secret xmr_hashrate_url
    name: Monero Hash Rate
    value_template: "{{ value_json.hash }}"
    unit_of_measurement: H/s
    json_attributes:
      - totalHashes
      - validShares
      - amtPaid
      - amtDue
      - txnCount
  - platform: statistics
    entity_id: sensor.monero_hash_rate
    name: statistics_monero_hash_rate
    max_age:
      hours: 24
  - platform: template
    sensors:
      monero_amount_earned:
        friendly_name: "Monero Amount Earned"
        value_template: "{{ state_attr('sensor.monero_hash_rate', 'amtDue') / 1000000000000 + state_attr('sensor.monero_hash_rate', 'amtPaid') / 1000000000000 }}"
        unit_of_measurement: "XMR"
      monero_total_hashes:
        friendly_name: "Monero Total Shares"
        value_template: "{{ state_attr('sensor.monero_hash_rate', 'totalHashes') }}"
        unit_of_measurement: "Hash"
      monero_valid_shares:
        friendly_name: "Monero Valid Shares"
        value_template: "{{ state_attr('sensor.monero_hash_rate', 'validShares') }}"
        unit_of_measurement: "Share"
      monero_hash_share_ratio:
        friendly_name: "Monero Hash to Share Ratio"
        value_template: "{{ state_attr('sensor.monero_hash_rate', 'totalHashes') / state_attr('sensor.monero_hash_rate', 'validShares') }}"
        unit_of_measurement: "Hash/Share"
      monero_hash_amount_earned_ratio:
        friendly_name: "Monero Hash to Share Ratio"
        value_template: "{{ state_attr('sensor.monero_hash_rate', 'totalHashes') / (state_attr('sensor.monero_hash_rate', 'amtDue') / 1000000000000 + state_attr('sensor.monero_hash_rate', 'amtPaid') / 1000000000000) }}"
        unit_of_measurement: "Hash/XMR"
      monero_share_amount_earned_ratio:
        friendly_name: "Monero Hash to Share Ratio"
        value_template: "{{ state_attr('sensor.monero_hash_rate', 'validShares') / (state_attr('sensor.monero_hash_rate', 'amtDue') / 1000000000000 + state_attr('sensor.monero_hash_rate', 'amtPaid') / 1000000000000) }}"
        unit_of_measurement: "Share/XMR"
      monero_average_hash_rate_24_hours:
        friendly_name: "Monero Average Hash Rate 24 Hours"
        value_template: "{{ state_attr('sensor.statistics_monero_hash_rate', 'mean') }}"
        unit_of_measurement: "Hash/s"

input_text:
  avanza_ibm_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_ibm_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert
  avanza_microsoft_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_microsoft_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert
  avanza_munich_re_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_munich_re_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert
  avanza_siemens_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_siemens_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert
  avanza_bayer_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_bayer_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert
  avanza_basf_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_basf_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert
  avanza_allianz_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_allianz_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert
  avanza_procter_and_gamble_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_procter_and_gamble_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert
  avanza_johnson_and_johnson_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_johnson_and_johnson_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert
  avanza_vinci_min:
    icon: mdi:arrow-collapse-up
    name: Min Alert
  avanza_vinci_max:
    icon: mdi:arrow-collapse-down
    name: Max Alert

automation:
 - id: avanza_ibm
   alias: Avanza IBM
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_ibm') | float > states('input_text.avanza_ibm_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_ibm') | float < states('input_text.avanza_ibm_min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_ibm') | float > states('input_text.avanza_ibm_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_ibm','name') }} over threshold of {{ states('input_text.avanza_ibm_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_ibm','name') }} under threshold of {{ states('input_text.avanza_ibm_min') }}"
           {% endif %}
 - id: avanza_microsoft
   alias: Avanza Microsoft
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_microsoft') | float > states('input_text.avanza_microsoft_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_microsoft') | float < states('input_text.avanza_microsoft_min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_microsoft') | float > states('input_text.avanza_microsoft_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_microsoft','name') }} over threshold of {{ states('input_text.avanza_microsoft_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_microsoft','name') }} under threshold of {{ states('input_text.avanza_microsoft_min') }}"
           {% endif %}
 - id: avanza_munich_re
   alias: Avanza Munich Re
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_munich_re') | float > states('input_text.avanza_munich_re_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_munich_re') | float < states('input_text.avanza_munich_re_min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_munich_re') | float > states('input_text.avanza_munich_re_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_munich_re','name') }} over threshold of {{ states('input_text.avanza_munich_re_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_munich_re','name') }} under threshold of {{ states('input_text.avanza_munich_re_min') }}"
           {% endif %}
 - id: avanza_siemens
   alias: Avanza Siemens
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_siemens') | float > states('input_text.avanza_siemens_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_siemens') | float < states('input_text.avanza_siemens_min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_siemens') | float > states('input_text.avanza_siemens_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_siemens','name') }} over threshold of {{ states('input_text.avanza_siemens_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_siemens','name') }} under threshold of {{ states('input_text.avanza_siemens_min') }}"
           {% endif %}
 - id: avanza_bayer
   alias: Avanza Bayer
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_bayer') | float > states('input_text.avanza_bayer_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_bayer') | float < states('input_text.avanza_bayer_min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_bayer') | float > states('input_text.avanza_bayer_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_bayer','name') }} over threshold of {{ states('input_text.avanza_bayer_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_bayer','name') }} under threshold of {{ states('input_text.avanza_bayer_min') }}"
           {% endif %}
 - id: avanza_basf
   alias: Avanza BASF
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_basf') | float > states('input_text.avanza_basf_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_basf') | float < states('input_text.avanza_basf_min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_basf') | float > states('input_text.avanza_basf_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_basf','name') }} over threshold of {{ states('input_text.avanza_basf_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_basf','name') }} under threshold of {{ states('input_text.avanza_basf_min') }}"
           {% endif %}
 - id: avanza_allianz
   alias: Avanza Allianz
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_allianz') | float > states('input_text.avanza_allianz_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_allianz') | float < states('input_text.avanza_allianz_min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_allianz') | float > states('input_text.avanza_allianz_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_allianz','name') }} over threshold of {{ states('input_text.avanza_allianz_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_allianz','name') }} under threshold of {{ states('input_text.avanza_allianz_min') }}"
           {% endif %}
 - id: avanza_procter_and_gamble
   alias: Avanza Procter And Gamble
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_procter_and_gamble') | float > states('input_text.avanza_procter_and_gamble_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_procter_and_gamble') | float < states('input_text.avanza_procter_and_gamble_min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_procter_and_gamble') | float > states('input_text.avanza_procter_and_gamble_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_procter_and_gamble','name') }} over threshold of {{ states('input_text.avanza_procter_and_gamble_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_procter_and_gamble','name') }} under threshold of {{ states('input_text.avanza_procter_and_gamble_min') }}"
           {% endif %}
 - id: avanza_johnson_and_johnson
   alias: Avanza Johnson And Johnson
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_johnson_and_johnson') | float > states('input_text.avanza_johnson_and_johnson_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_johnson_and_johnson') | float < states('input_text.avanza_johnson_and_johnson_min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_johnson_and_johnson') | float > states('input_text.avanza_johnson_and_johnson_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_johnson_and_johnson','name') }} over threshold of {{ states('input_text.avanza_johnson_and_johnson_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_johnson_and_johnson','name') }} under threshold of {{ states('input_text.avanza_johnson_and_johnson_min') }}"
           {% endif %}
 - id: avanza_vinci
   alias: Avanza VINCI
   trigger:
     - platform: template
       value_template: >
        {{ states('sensor.avanza_vinci') | float > states('input_text.avanza_vinci_max') | float }}
     - platform: template
       value_template: >
        {{ states('sensor.avanza_vinci') | float < states('input_text.avanza_vinci_>min') | float }}
   action:
     - service: notify.kevin
       data_template:
         message: >
           {% if states('sensor.avanza_vinci') | float > states('input_text.avanza_vinci_max') | float %}
           "Stock alert: {{ state_attr('sensor.avanza_vinci','name') }} over threshold of {{ states('input_text.avanza_vinci_max') }}"
           {% else %}
           "Stock alert: {{ state_attr('sensor.avanza_vinci','name') }} under threshold of {{ states('input_text.avanza_vinci_min') }}"
           {% endif %}